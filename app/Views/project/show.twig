{% extends "layout/main.twig" %}

{% block content %}

<h2>{{ title }}</h2>

<p>{{ project.description }}</p>
<p>Créé le : {{ project.created_at }}</p>

<h3>Mots de passe du projet</h3>

<!-- Lien pour ajouter un nouveau mot de passe -->
<a href="{{ url('/projects/' ~ project_id ~ '/passwords/create') }}">
    Ajouter un nouveau mot de passe
</a>

{% if passwords is empty %}
    <p>Aucun mot de passe associé à ce projet.</p>
{% else %}
<table>
    <tr>
        <th>Type</th>
        <th>Label</th>
        <th>Champs</th>
        <th>Sécurité</th>
        <th>Fichiers</th>
        <th>Action</th>
    </tr>

    {% for p in passwords %}
    <tr style="background: {{ p.type_color }}">
        <td>{{ p.type_label }}</td>
        <td>{{ p.label }}</td>

        <!-- Affichage des champs du mot de passe -->
        <td>
            {% for key, value in p.extra %}
                <div class="field-line">
                    <div>
                        <strong>{{ key }}</strong> :
                <span class="hidden-value" style="display:none">
                {{value}}
                </span>
                <span class="hidden-mask">
                    **********
                </span>
                    </div>

                <button type="button"
                        class="toggle-btn"
                        onclick="toggleField(this)">
                Afficher
                </button>

                <button type="button"
                    class="copy-btn"
                    onclick="copyField(this)"
                    data-value="{{ value }}">
                    Copier
                </button>
                </div>
                
            {% endfor %}
        </td>
        <td>
    {% set level = p.level|lower %}
    <span style="
        padding: 2px 6px;
        border-radius: 4px;
        color: #fff;
        font-weight: bold;
        font-size: 0.85em;
        {% if level == 'faible' %}background-color: #e74c3c;{% endif %}
        {% if level == 'moyen' %}background-color: #f1c40f; color: #000;{% endif %}
        {% if level == 'fort'  %}background-color: #2ecc71;{% endif %}
    ">
        {{ p.level|capitalize }}
    </span>

    <div class="progress mt-1" style="height: 5px; background-color: #eee; border-radius: 3px; margin-top: 2px;">
        <div class="progress-bar" style="
            height: 100%;
            border-radius: 3px;
            {% if level == 'faible' %}background-color: #e74c3c;{% endif %}
            {% if level == 'moyen' %}background-color: #f1c40f;{% endif %}
            {% if level == 'fort'  %}background-color: #2ecc71;{% endif %}
            width: {{ p.score }}%;
        "></div>
    </div>
</td>



        <!-- Affichage des fichiers associés au mot de passe -->
        <td>
            <h4>Fichiers :</h4>
            {% if p.files is empty %}
                <p>Aucun fichier</p>
            {% else %}
                <ul>
                {% for file in p.files %}
                    <li>
                        {{ file.filename }} ({{ file.size }} octets)
                        <a href="{{ url('/files/' ~ file.id ~ '/download') }}">Télécharger</a>
                        <a href="{{ url('/files/' ~ file.id ~ '/delete') }}" onclick="return confirm('Supprimer ce fichier ?')">Supprimer</a>
                    </li>
                {% endfor %}
                </ul>
            {% endif %}
        </td>

        <!-- Actions pour le mot de passe -->
        <td>
            <a href="{{ url('/projects/' ~ project_id ~ '/passwords/' ~ p.id ~ '/edit') }}">Modifier</a>

            <form action="{{ url('/projects/' ~ project_id ~ '/passwords/' ~ p.id ~ '/delete') }}" method="POST">
                <button type="submit" onclick="return confirm('Supprimer ?')">Supprimer</button>
            </form>
        </td>
    </tr>
    {% endfor %}
</table>
{% endif %}

{% endblock %}
